# ë³µì¡í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì—ì„œ tRPCë¡œ: ê°œë°œ ìƒì‚°ì„±ì„ 2ë°° í–¥ìƒì‹œí‚¨ ì•„í‚¤í…ì²˜ ì „í™˜ê¸°

## ğŸ¯ ë“¤ì–´ê°€ë©°

"ë˜ ë¹Œë“œ ì—ëŸ¬ì•¼? ì´ë²ˆì—” ë­ê°€ ë¬¸ì œì§€?"

ê°œë°œíŒ€ì—ì„œ ìì£¼ ë“¤ë¦¬ë˜ í•œìˆ¨ ì„ì¸ ë§ì´ì—ˆìŠµë‹ˆë‹¤. ê°„ë‹¨í•œ API í•˜ë‚˜ ì¶”ê°€í•˜ëŠ”ë°ë„ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ë¥¼ ê±°ì³ì•¼ í•˜ê³ , í•œ ê³³ì„ ìˆ˜ì •í•˜ë©´ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë“¤ì´ ì—°ì‡„ì ìœ¼ë¡œ ì˜í–¥ì„ ë°›ëŠ” ìƒí™©. ì´ëŸ° ë³µì¡í•œ ì•„í‚¤í…ì²˜ ì†ì—ì„œ ìš°ë¦¬ëŠ” **tRPC**ë¼ëŠ” í•´ë‹µì„ ì°¾ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

## ğŸ—ï¸ ê¸°ì¡´ ì•„í‚¤í…ì²˜ì˜ ë”œë ˆë§ˆ

### ë³µì¡í•¨ì˜ ê·¹ì¹˜: 5ë‹¨ê³„ ë ˆì´ì–´

ìš°ë¦¬ì˜ ê¸°ì¡´ ì•„í‚¤í…ì²˜ëŠ” ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤:

```
[Client] â†’ [BFF] â†’ [IDL] â†’ [gRPC] â†’ [Go Server]
```

ì–¸ëœ» ë³´ë©´ ì˜ ì„¤ê³„ëœ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ê°™ì§€ë§Œ, ì‹¤ì œ ê°œë°œ í˜„ì‹¤ì€ ë‹¬ëìŠµë‹ˆë‹¤.

### ğŸš¨ ì§ë©´í•œ ë¬¸ì œë“¤

#### 1. **ê°„ë‹¨í•œ ê¸°ëŠ¥ í•˜ë‚˜ë„ ë³µì¡í•œ ì—¬ì •**

í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì‚¬ìš©ì ì •ë³´ í•˜ë‚˜ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´:

- Go Serverì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
- gRPC ì„œë¹„ìŠ¤ ì •ì˜
- IDL íŒŒì¼ ì—…ë°ì´íŠ¸
- BFFì—ì„œ GraphQL ìŠ¤í‚¤ë§ˆ ë§¤í•‘
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ GraphQL ì¿¼ë¦¬ ì‘ì„±

#### 2. **GraphQL Code Generationì˜ ë«**

ëª¨ë“  í”„ë¡œì íŠ¸ê°€ ë™ì¼í•œ GraphQL ìŠ¤í‚¤ë§ˆì—ì„œ ìƒì„±ëœ ì½”ë“œë¥¼ ë°”ë¼ë³´ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

```typescript
// ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©
import { GetUserQuery, User } from "@shared/graphql-generated";
```

**ë¬¸ì œëŠ” ì—¬ê¸°ì„œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤:**

- A í”„ë¡œì íŠ¸ì—ì„œ User íƒ€ì… ìˆ˜ì • â†’ B, C, D í”„ë¡œì íŠ¸ ëª¨ë‘ ì˜í–¥
- í•œ íŒ€ì˜ ìˆ˜ì •ì‚¬í•­ìœ¼ë¡œ ë‹¤ë¥¸ íŒ€ì˜ ë¹Œë“œ ì‹¤íŒ¨
- ìˆ˜ì • ì „ ëª¨ë“  í”„ë¡œì íŠ¸ ë¹Œë“œ í…ŒìŠ¤íŠ¸ í•„ìˆ˜
- ë†“ì¹˜ëŠ” ì¼€ì´ìŠ¤ ë°œìƒ ì‹œ í”„ë¡œë•ì…˜ ì¥ì• 

#### 3. **í˜‘ì—… ë¹„ìš©ì˜ ê¸‰ì¦**

```bash
# ë§¤ë²ˆ ë°˜ë³µë˜ëŠ” ë¶ˆì•ˆí•œ ë£¨í‹´
$ git push feature/user-profile-update
$ # 5ë¶„ í›„...
$ "ì•„, AíŒ€ ë¹Œë“œ ê¹¨ì¡Œë„¤ìš”. ë˜ëŒë ¤ì£¼ì„¸ìš” ğŸ˜…"
```

## ğŸ’¡ í•´ê²°ì±… ëª¨ìƒ‰ ê³¼ì •

### ì²« ë²ˆì§¸ ì‹œë„: RESTful API ë¶„ë¦¬

```typescript
// ë„ë©”ì¸ë³„ REST API
GET / api / user / profile;
GET / api / book / list;
GET / api / payment / history;
```

í•˜ì§€ë§Œ ì´ ë°©ë²•ì€ **íƒ€ì… ì•ˆì •ì„±**ì´ë¼ëŠ” GraphQLì˜ í•µì‹¬ ì¥ì ì„ í¬ê¸°í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.

### ë‘ ë²ˆì§¸ ì œì•ˆ: tRPC ë„ì…

"íƒ€ì… ì•ˆì •ì„±ì€ ìœ ì§€í•˜ë©´ì„œ ì˜ì¡´ì„±ì€ ê²©ë¦¬í•  ìˆ˜ ì—†ì„ê¹Œ?"

NestJSì™€ tRPCì˜ ì¡°í•©ì„ ì—°êµ¬í•œ ê²°ê³¼, ì´ìƒì ì¸ í•´ë‹µì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.

## ğŸš€ tRPC ì•„í‚¤í…ì²˜ ì„¤ê³„

### ìƒˆë¡œìš´ ì•„í‚¤í…ì²˜ êµ¬ì¡°

```
[Client Apps] â† HTTP â†’ [NestJS BFF] â† Direct DB â†’ [Database]
     â†“                      â†“
[Domain-specific]      [Domain-specific]
[tRPC Clients]         [tRPC Routers]
```

### ë„ë©”ì¸ë³„ ê²©ë¦¬ ì „ëµ

#### 1. **ë°±ì—”ë“œ: ë„ë©”ì¸ë³„ tRPC ë¼ìš°í„° ë¶„ë¦¬**

```typescript
// apps/apigateway/src/v2/solve-books/solve-books.trpc.router.ts
@Injectable()
export class SolveBooksRouter {
  constructor(private readonly trpc: TrpcService) {}

  get solveBooksRouter() {
    return this.trpc.router({
      store: this.storeRouter.router,
      user: this.userRouter.router,
    });
  }
}

// apps/apigateway/src/v2/admin/admin.trpc.router.ts
@Injectable()
export class AdminRouter {
  constructor(private readonly trpc: TrpcService) {}

  get adminRouter() {
    return this.trpc.router({
      dashboard: this.dashboardRouter.router,
      settings: this.settingsRouter.router,
    });
  }
}
```

#### 2. **íƒ€ì… ê²©ë¦¬: ë„ë©”ì¸ë³„ íƒ€ì… ìµìŠ¤í¬íŠ¸**

```typescript
// apps/apigateway/exports.ts
export type { SolveBooksAppRouter } from "./src/v2/solve-books/solve-books.trpc.router";
export type { AdminAppRouter } from "./src/v2/admin/admin.trpc.router";
export type { ConverterAppRouter } from "./src/v2/converter/converter.trpc.router";
```

#### 3. **í´ë¼ì´ì–¸íŠ¸: ë…ë¦½ì ì¸ tRPC í´ë¼ì´ì–¸íŠ¸**

```typescript
// apps/solve-books/src/utils/trpc.ts
import { createTRPCClient } from "@trpc/client";
import type { SolveBooksAppRouter } from "@apigateway/types";

const trpcClient = createTRPCClient<SolveBooksAppRouter>({
  links: [
    httpBatchLink({
      url: "http://localhost:5500/trpc/solve-books",
    }),
  ],
});

// apps/admin/src/utils/trpc.ts
import type { AdminAppRouter } from "@apigateway/types";

const trpcClient = createTRPCClient<AdminAppRouter>({
  links: [
    httpBatchLink({
      url: "http://localhost:5500/trpc/admin",
    }),
  ],
});
```

### TanStack Query í†µí•©ìœ¼ë¡œ ì™„ì„±

```typescript
// ìºì‹±, ë¦¬íŠ¸ë¼ì´, ì—ëŸ¬ í•¸ë“¤ë§ì´ ëª¨ë‘ ìë™í™”
export const trpc = createTRPCOptionsProxy<SolveBooksAppRouter>({
  client: trpcClient,
  queryClient,
});

// ì»´í¬ë„ŒíŠ¸ì—ì„œì˜ ì‚¬ìš©
function ProductList() {
  const { data, isLoading, error } = useQuery(
    trpc.store.product.list.queryOptions({
      category: "textbook",
      limit: 10,
    })
  );

  if (isLoading) return <Loading />;
  if (error) return <Error message={error.message} />;

  return <ProductGrid products={data} />;
}
```

## ğŸ“Š ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³¼

### ğŸ¯ ì •ëŸ‰ì  ì„±ê³¼

| ì§€í‘œ               | ì´ì „              | ì´í›„         | ê°œì„ ìœ¨        |
| ------------------ | ----------------- | ------------ | ------------- |
| API ê°œë°œ ì‹œê°„      | 2-3ì¼             | 4-6ì‹œê°„      | **75% ë‹¨ì¶•**  |
| ë¹Œë“œ ì—ëŸ¬ ë°œìƒ     | ì£¼ 5-7íšŒ          | ì£¼ 0-1íšŒ     | **85% ê°ì†Œ**  |
| í”„ë¡œì íŠ¸ ê°„ ì˜ì¡´ì„± | 100% ê³µìœ          | 0% ê²©ë¦¬      | **ì™„ì „ ë¶„ë¦¬** |
| íƒ€ì… ì•ˆì •ì„±        | GraphQL Generated | Runtime Safe | **í–¥ìƒ**      |

### ğŸš€ ì •ì„±ì  ì„±ê³¼

#### 1. **ê°œë°œì ê²½í—˜ì˜ í˜ì‹ **

```typescript
// Before: ë³µì¡í•œ GraphQL ì¿¼ë¦¬ ì‘ì„±
const GET_USER_PROFILE = gql`
  query GetUserProfile($userId: ID!) {
    user(id: $userId) {
      id
      name
      email
      profile {
        avatar
        bio
      }
    }
  }
`;

// After: ì§ê´€ì ì¸ tRPC í˜¸ì¶œ
const userProfile = await trpc.user.getProfile.query({ userId });
```

#### 2. **ì‹¤ì‹œê°„ íƒ€ì… ë™ê¸°í™”**

ë°±ì—”ë“œ API ë³€ê²½ â†’ ì¦‰ì‹œ í”„ë¡ íŠ¸ì—”ë“œ íƒ€ì… ë°˜ì˜ â†’ IDEì—ì„œ ì‹¤ì‹œê°„ ì—ëŸ¬ í‘œì‹œ

#### 3. **ë„ë©”ì¸ë³„ ììœ¨ì„± í™•ë³´**

- ê° íŒ€ì´ ìì‹ ì˜ APIë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬
- ë‹¤ë¥¸ íŒ€ì— ì˜í–¥ ì—†ì´ ììœ ë¡œìš´ ê°œë°œ
- ë°°í¬ ì£¼ê¸°ì˜ ë…ë¦½ì„± í™•ë³´

## ğŸ” ê¸°ìˆ ì  ì‹¬í™”: êµ¬í˜„ ë””í…Œì¼

### 1. **NestJS ëª¨ë“ˆ êµ¬ì¡°**

```typescript
// v2.module.ts - ëª¨ë“  ë„ë©”ì¸ ëª¨ë“ˆì˜ í†µí•©ì 
@Module({
  imports: [
    TrpcModule,
    SolveBooksModule,
    AdminModule,
    ConverterModule,
    ScmModule,
  ],
  exports: [TrpcModule, SolveBooksModule, AdminModule],
})
export class V2Module {}
```

### 2. **tRPC ì„œë¹„ìŠ¤ ì„¤ì •**

```typescript
// trpc-setup.service.ts - ë„ë©”ì¸ë³„ ë¼ìš°í„° ë“±ë¡
@Injectable()
export class TrpcSetupService {
  setupAllTrpcRoutes(app: INestApplication): void {
    this.setupSolveBooksRoutes(app);
    this.setupAdminRoutes(app);
    this.setupConverterRoutes(app);
  }

  private setupSolveBooksRoutes(app: INestApplication): void {
    const solveBooksRouter = app.get(SolveBooksRouter);

    app.use(
      "/trpc/solve-books",
      trpcExpress.createExpressMiddleware({
        router: solveBooksRouter.solveBooksRouter,
        createContext: () => ({}),
      })
    );
  }
}
```

### 3. **íƒ€ì… ì•ˆì „ì„± ë³´ì¥**

```typescript
// Zod ìŠ¤í‚¤ë§ˆë¡œ ëŸ°íƒ€ì„ ê²€ì¦
export const SearchProductSchema = z.object({
  category: z.string().optional(),
  minPrice: z.number().optional(),
  maxPrice: z.number().optional(),
  limit: z.number().min(1).max(100).default(10),
});

export type SearchProductInput = z.infer<typeof SearchProductSchema>;

// tRPC í”„ë¡œì‹œì €ì—ì„œ ì‚¬ìš©
export const productRouter = router({
  search: procedure.input(SearchProductSchema).query(async ({ input }) => {
    // inputì€ ìë™ìœ¼ë¡œ íƒ€ì… ì¶”ë¡ ë¨
    return await productService.search(input);
  }),
});
```

## ğŸ¤” ë„ì… ê³¼ì •ì˜ ê³ ë¯¼ê³¼ í•´ê²°

### 1. **ê¸°ì¡´ GraphQL ì½”ë“œì™€ì˜ ê³µì¡´**

ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìœ„í•´ GraphQLê³¼ tRPCë¥¼ ë³‘í–‰ ìš´ì˜:

```typescript
// ê¸°ì¡´ GraphQLì€ ìœ ì§€í•˜ë©´ì„œ
app.use("/graphql", graphqlUploadExpress(), graphqlMiddleware);

// ìƒˆë¡œìš´ tRPC ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
app.use("/trpc", trpcMiddleware);
```

### 2. **íŒ€ ì„¤ë“ê³¼ í•™ìŠµ ê³¡ì„ **

- ì†Œê·œëª¨ í”„ë¡œì íŠ¸ë¶€í„° tRPC ì ìš©í•˜ì—¬ íš¨ê³¼ ì…ì¦
- ê°œë°œíŒ€ ì›Œí¬ìƒµì„ í†µí•œ ì§€ì‹ ê³µìœ 
- ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ ë¬¸ì„œ ì‘ì„±

### 3. **ëª¨ë‹ˆí„°ë§ê³¼ ë””ë²„ê¹…**

```typescript
// tRPC Panelì„ í†µí•œ API ë¬¸ì„œí™” ë° í…ŒìŠ¤íŠ¸
app.use("/panel", (_, res) => {
  return res.send(
    renderTrpcPanel(appRouter, {
      url: "http://localhost:5500/trpc",
    })
  );
});
```

## ğŸ‰ ë§ˆë¬´ë¦¬

ë³µì¡í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì—ì„œ ì‹œì‘ëœ ì—¬ì •ì´ tRPCë¡œ ì™„ì „íˆ ìƒˆë¡œìš´ ê°œë°œ ê²½í—˜ì„ ë§Œë“¤ì–´ëƒˆìŠµë‹ˆë‹¤.

**í•µì‹¬ì€ "ê¸°ìˆ ì„ ìœ„í•œ ê¸°ìˆ ì´ ì•„ë‹Œ, ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ê¸°ìˆ "**ì´ì—ˆìŠµë‹ˆë‹¤. GraphQLì˜ íƒ€ì… ì•ˆì •ì„±ì€ ìœ ì§€í•˜ë©´ì„œë„ ì˜ì¡´ì„± ì§€ì˜¥ì—ì„œ ë²—ì–´ë‚  ìˆ˜ ìˆì—ˆê³ , ê°œë°œíŒ€ì˜ ìƒì‚°ì„±ì€ ëˆˆì— ë„ê²Œ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

í˜¹ì‹œ ë¹„ìŠ·í•œ ì•„í‚¤í…ì²˜ ê³ ë¯¼ì„ í•˜ê³  ê³„ì‹ ë‹¤ë©´, tRPCëŠ” ì •ë§ ì¢‹ì€ ì„ íƒì§€ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ TypeScript ê¸°ë°˜ í’€ìŠ¤íƒ ê°œë°œ í™˜ê²½ì—ì„œëŠ” ê·¸ ì§„ê°€ë¥¼ ë°œíœ˜í•  ê²ƒì…ë‹ˆë‹¤.

---

> **"ë³µì¡í•¨ì„ ë‹¨ìˆœí•¨ìœ¼ë¡œ, ì˜ì¡´ì„±ì„ ë…ë¦½ì„±ìœ¼ë¡œ"**  
> ì´ê²ƒì´ ìš°ë¦¬ê°€ tRPCë¥¼ í†µí•´ ì–»ì€ ê°€ì¥ í° êµí›ˆì…ë‹ˆë‹¤.
